<div data-role="page" id="categories" data-title="Categories">

  <%= render :partial => 'shared/header' %>

  <div data-role="content">
    <div class="content-primary">
    <div style="width: 320px; margin: 0 auto;">
      <div id="container" style="width: 100%; height: 400px"></div>
      <p><%= link_to image_tag('submit_rate.png'), rate_event_path(@event), :"data-transition" => "pop" %></p>
    </div>

    <ul data-role="listview" class="comment_list">
    <% @comments.each do |comment| %>
      <li class="comment ui-li-static" data-id=<%= comment.id %>>
        <p class="ui-li-aside ui-li-desc">
        <%= link_to image_tag('rate_up.png'), vote_up_comment_path(comment), :remote => true, :method => :post, :class => "comment_vote" %><br /><%= link_to image_tag('rate_down.png'), vote_down_comment_path(comment), :remote => true, :method => :post, :class => "comment_vote" %> 
        </p>
        <p class="ui-li-desc">
          <em><%= comment.created_at.strftime('%m/%e/%Y') %></em><br />
          <%= comment.comment_text.html_safe %>
        </p>
      </li>
  <% end %>
  </ul>
  </div>
</div>


  <%= render :partial => 'shared/footer' %>
</div>

<%
@votes.each do |vote|
if vote.vote
  @rating = @rating + 1 
else
  @rating = @rating - 1 
end

if @data.empty? || (@data.last - @rating).abs >= 3
  @data.push(@rating)

end
end
%>

<script type="text/javascript">
$('div[data-role="page"]').live('pagecreate', function() {
  console.log("PAGE LOADED");
  chart = new Highcharts.Chart({
    chart: {
      renderTo: 'container',
      type: 'line',
      marginBottom: 25,
      width: 320
    },
    title: {
      text: 'Rating Over Time',
      x: -20 //center
    },
    yAxis: {
      title: {
        text: ''
      },
      plotLines: [{
        value: 0,
        width: 1,
        color: '#808080'
      }]
    },
    tooltip: {
      formatter: function() {
          return '<b>'+ this.series.name +'</b><br/>'+
          this.x +': '+ this.y;
      }
    },
    series: [{
      name: 'Rating',
      data: <%= @data.each {|d| print d} %>
    }]
  });
});
</script>